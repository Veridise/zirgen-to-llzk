// RUN: zklang -o - %s | FileCheck --enable-var-scope %s

component Foo(x: ExtVal, y: ExtVal) {
// CHECK-LABEL: llzk.struct @Foo<[]> {
// CHECK: field @"$super" : !llzk.array<4 x !llzk.felt>

// CHECK-LABEL: func @compute
// CHECK-SAME: (%[[A0:[0-9a-zA-Z_\.]+]]: !llzk.array<4 x !llzk.felt>, %[[A1:[0-9a-zA-Z_\.]+]]: !llzk.array<4 x !llzk.felt>) -> !llzk.struct<@Foo<[]>> {

// CHECK-DAG: %[[C0:[0-9a-zA-Z_\.]+]] = index.constant  0
// CHECK-DAG: %[[C1:[0-9a-zA-Z_\.]+]] = index.constant  1
// CHECK-DAG: %[[C2:[0-9a-zA-Z_\.]+]] = index.constant  2
// CHECK-DAG: %[[C3:[0-9a-zA-Z_\.]+]] = index.constant  3
// CHECK-DAG: %[[T0:[0-9a-zA-Z_\.]+]] = readarr %[[A0]][%[[C0]]] : <4 x !llzk.felt>, !llzk.felt
// CHECK-DAG: %[[T1:[0-9a-zA-Z_\.]+]] = readarr %[[A0]][%[[C1]]] : <4 x !llzk.felt>, !llzk.felt
// CHECK-DAG: %[[T2:[0-9a-zA-Z_\.]+]] = readarr %[[A0]][%[[C2]]] : <4 x !llzk.felt>, !llzk.felt
// CHECK-DAG: %[[T3:[0-9a-zA-Z_\.]+]] = readarr %[[A0]][%[[C3]]] : <4 x !llzk.felt>, !llzk.felt

// CHECK-DAG: %[[C4:[0-9a-zA-Z_\.]+]] = index.constant  0
// CHECK-DAG: %[[C5:[0-9a-zA-Z_\.]+]] = index.constant  1
// CHECK-DAG: %[[C6:[0-9a-zA-Z_\.]+]] = index.constant  2
// CHECK-DAG: %[[C7:[0-9a-zA-Z_\.]+]] = index.constant  3
// CHECK-DAG: %[[T4:[0-9a-zA-Z_\.]+]] = readarr %[[A1]][%[[C4]]] : <4 x !llzk.felt>, !llzk.felt
// CHECK-DAG: %[[T5:[0-9a-zA-Z_\.]+]] = readarr %[[A1]][%[[C5]]] : <4 x !llzk.felt>, !llzk.felt
// CHECK-DAG: %[[T6:[0-9a-zA-Z_\.]+]] = readarr %[[A1]][%[[C6]]] : <4 x !llzk.felt>, !llzk.felt
// CHECK-DAG: %[[T7:[0-9a-zA-Z_\.]+]] = readarr %[[A1]][%[[C7]]] : <4 x !llzk.felt>, !llzk.felt

// CHECK-DAG: %[[T8:[0-9a-zA-Z_\.]+]] = add %[[T0]], %[[T4]] : !llzk.felt, !llzk.felt
// CHECK-DAG: %[[T9:[0-9a-zA-Z_\.]+]] = add %[[T1]], %[[T5]] : !llzk.felt, !llzk.felt
// CHECK-DAG: %[[T10:[0-9a-zA-Z_\.]+]] = add %[[T2]], %[[T6]] : !llzk.felt, !llzk.felt
// CHECK-DAG: %[[T11:[0-9a-zA-Z_\.]+]] = add %[[T3]], %[[T7]] : !llzk.felt, !llzk.felt

// CHECK-DAG: %[[T12:[0-9a-zA-Z_\.]+]] = new_array %[[T8]], %[[T9]], %[[T10]], %[[T11]] : <4 x !llzk.felt>

// CHECK-LABEL: func @constrain(%arg0: !llzk.struct<@Foo<[]>>, 
// CHECK-SAME: %[[A0:[0-9a-zA-Z_\.]+]]: !llzk.array<4 x !llzk.felt>, 
// CHECK-SAME: %[[A1:[0-9a-zA-Z_\.]+]]: !llzk.array<4 x !llzk.felt>) {

// CHECK-DAG: %[[C0:[0-9a-zA-Z_\.]+]] = index.constant  0
// CHECK-DAG: %[[C1:[0-9a-zA-Z_\.]+]] = index.constant  1
// CHECK-DAG: %[[C2:[0-9a-zA-Z_\.]+]] = index.constant  2
// CHECK-DAG: %[[C3:[0-9a-zA-Z_\.]+]] = index.constant  3
// CHECK-DAG: %[[T0:[0-9a-zA-Z_\.]+]] = readarr %[[A0]][%[[C0]]] : <4 x !llzk.felt>, !llzk.felt
// CHECK-DAG: %[[T1:[0-9a-zA-Z_\.]+]] = readarr %[[A0]][%[[C1]]] : <4 x !llzk.felt>, !llzk.felt
// CHECK-DAG: %[[T2:[0-9a-zA-Z_\.]+]] = readarr %[[A0]][%[[C2]]] : <4 x !llzk.felt>, !llzk.felt
// CHECK-DAG: %[[T3:[0-9a-zA-Z_\.]+]] = readarr %[[A0]][%[[C3]]] : <4 x !llzk.felt>, !llzk.felt

// CHECK-DAG: %[[C4:[0-9a-zA-Z_\.]+]] = index.constant  0
// CHECK-DAG: %[[C5:[0-9a-zA-Z_\.]+]] = index.constant  1
// CHECK-DAG: %[[C6:[0-9a-zA-Z_\.]+]] = index.constant  2
// CHECK-DAG: %[[C7:[0-9a-zA-Z_\.]+]] = index.constant  3
// CHECK-DAG: %[[T4:[0-9a-zA-Z_\.]+]] = readarr %[[A1]][%[[C4]]] : <4 x !llzk.felt>, !llzk.felt
// CHECK-DAG: %[[T5:[0-9a-zA-Z_\.]+]] = readarr %[[A1]][%[[C5]]] : <4 x !llzk.felt>, !llzk.felt
// CHECK-DAG: %[[T6:[0-9a-zA-Z_\.]+]] = readarr %[[A1]][%[[C6]]] : <4 x !llzk.felt>, !llzk.felt
// CHECK-DAG: %[[T7:[0-9a-zA-Z_\.]+]] = readarr %[[A1]][%[[C7]]] : <4 x !llzk.felt>, !llzk.felt

// CHECK-DAG: %[[T8:[0-9a-zA-Z_\.]+]] = add %[[T0]], %[[T4]] : !llzk.felt, !llzk.felt
// CHECK-DAG: %[[T9:[0-9a-zA-Z_\.]+]] = add %[[T1]], %[[T5]] : !llzk.felt, !llzk.felt
// CHECK-DAG: %[[T10:[0-9a-zA-Z_\.]+]] = add %[[T2]], %[[T6]] : !llzk.felt, !llzk.felt
// CHECK-DAG: %[[T11:[0-9a-zA-Z_\.]+]] = add %[[T3]], %[[T7]] : !llzk.felt, !llzk.felt

// CHECK-DAG: %[[T12:[0-9a-zA-Z_\.]+]] = new_array %[[T8]], %[[T9]], %[[T10]], %[[T11]] : <4 x !llzk.felt>

  ExtAdd(x, y)
}

